import*as e from"fs";import t from"fs";import*as n from"path";import*as r from"os";import o from"os";import i from"playwright-core";import{get as u}from"https";import s from"node-stream-zip";function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function a(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t.indexOf(n=i[r])>=0||(o[n]=e[n]);return o}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}const m="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function v(e,t,n){if(!e.s){if(n instanceof d){if(!n.s)return void(n.o=v.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(v.bind(null,e,t),v.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var d=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{v(r,1,i(this.v))}catch(e){v(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?v(r,1,t?t(o):o):n?v(r,1,n(o)):v(r,2,o)}catch(e){v(r,2,e)}},r},e}();function P(e){return e instanceof d&&1&e.s}var p=function(e,t){return function(n,r){void 0===r&&(r=t);try{var o=function(e,t,n){if("function"==typeof e[m]){var r,o,i,u=e[m]();if(function e(n){try{for(;!(r=u.next()).done;)if((n=t(r.value))&&n.then){if(!P(n))return void n.then(e,i||(i=v.bind(null,o=new d,2)));n=n.v}o?v(o,1,n):o=n}catch(e){v(o||(o=new d),2,e)}}(),u.return){var s=function(e){try{r.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(s,function(e){throw s(e)});s()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],l=0;l<e.length;l++)c.push(e[l]);return function(e,t,n){var r,o,i=-1;return function n(u){try{for(;++i<e.length;)if((u=t(i))&&u.then){if(!P(u))return void u.then(n,o||(o=v.bind(null,r=new d,2)));u=u.v}r?v(r,1,u):r=u}catch(e){v(r||(r=new d),2,e)}}(),r}(c,function(e){return t(c[e])})}(r,function(t){return Promise.resolve(t(e,n)).then(function(){})});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}},y=function(e,t){if(e===t)return!1;for(var n=e.replace(/[^\d.-]/g,"").split("."),r=t.replace(/[^\d.-]/g,"").split("."),o=n.length>r.length?n.length:r.length,i=0;i<o;i++)if((Number(n[i])||0)!==(Number(r[i])||0))return(Number(r[i])||0)>(Number(n[i])||0);return!0},g=function(t){return 0===e.readdirSync(t,{withFileTypes:!0}).filter(function(e){return e.isFile()&&!e.name.startsWith(".")}).length},w=function(e,t,n){return function(r){try{var o,i=r.version,u=function(){if(i)return console.log(""),"latest"===i?console.warn("[33m%s[0m","It is not recommended to run "+e+' with "latest" version. Use it at your own risk or set to the recommended version "'+n+'".'):y(n,i)?console.warn("[33m%s[0m","Seems you are running a newer version ("+i+") of "+e+' than recommended by the Dappwright team.\n      Use it at your own risk or set to the recommended version "'+n+'".'):y(i,n)?console.warn("[33m%s[0m","Seems you are running an older version ("+i+") of "+e+' than recommended by the Dappwright team.\n      Use it at your own risk or set the recommended version "'+n+'".'):console.log("Running tests on "+e+" version "+i),console.log(""),Promise.resolve(k(i,t,b(e))).then(function(e){o=e});console.log("Running tests on local "+e+" build")}();return Promise.resolve(u&&u.then?u.then(function(){return o}):o)}catch(e){return Promise.reject(e)}}},b=function(e){return n.resolve(r.tmpdir(),"dappwright",e)},k=function(t,r,o){try{var i=n.resolve(o,t.replace(/\./g,"_"));return"latest"!==t&&e.existsSync(i)&&!g(i)?Promise.resolve(i):(console.log("Downloading extension..."),Promise.resolve(S(r,"v"+t)).then(function(t){var r=t.filename,u=t.downloadUrl;e.existsSync(i)&&g(i)&&e.rmdirSync(i,{recursive:!0});var c=function(){if(!e.existsSync(i)||g(i))return Promise.resolve(T(r,u,o)).then(function(t){var r=new s.async({file:t});return e.mkdirSync(i),Promise.resolve(r.extract(null,i)).then(function(){var t=n.resolve(i,"manifest.json"),r=JSON.parse(e.readFileSync(t,"utf-8"));r.key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnpiOcYGaEp02v5On5luCk/4g9j+ujgWeGlpZVibaSz6kUlyiZvcVNIIUXR568uv5NrEi5+j9+HbzshLALhCn9S43E7Ha6Xkdxs3kOEPBu8FRNwFh2S7ivVr6ixnl2FCGwfkP1S1r7k665eC1/xYdJKGCc8UByfSw24Rtl5odUqZX1SaE6CsQEMymCFcWhpE3fV+LZ6RWWJ63Zm1ac5KmKzXdj7wZzN3onI0Csc8riBZ0AujkThJmCR8tZt2PkVUDX9exa0XkJb79pe0Ken5Bt2jylJhmQB7R3N1pVNhNQt17Sytnwz6zG2YsB2XNd/1VYJe52cPNJc7zvhQJpHjh5QIDAQAB",e.writeFileSync(t,JSON.stringify(r))})})}();return c&&c.then?c.then(function(){return i}):i}))}catch(e){return Promise.reject(e)}},T=function(t,r,o){return new Promise(function(i){try{e.existsSync(o)||e.mkdirSync(o,{recursive:!0});var s=n.join(o,t),c=e.createWriteStream(s);return Promise.resolve(function(e){return new Promise(function(t){u(e,function(e){302==e.statusCode?u(e.headers.location,t).on("error",function(e){throw console.warn("request redirected error:",e.message),e}):t(e)}).on("error",function(e){throw console.warn("request error:",e.message),e})})}(r)).then(function(e){e.pipe(c),e.on("end",function(){i(s)})})}catch(e){return Promise.reject(e)}})},S=function(e,t){return new Promise(function(n,r){var o={headers:{"User-Agent":"Mozilla/5.0"}};process.env.GITHUB_TOKEN&&(o.headers.Authorization="Bearer "+process.env.GITHUB_TOKEN),u(e,o,function(e){var o="";e.on("data",function(e){o+=e}),e.on("end",function(){var e=JSON.parse(o);if(e.message)return r(e.message);for(var i,u=h(e);!(i=u()).done;){var s=i.value;if(!s.draft&&("latest"===t||s.name.includes(t)||s.tag_name.includes(t)))for(var c,l=h(s.assets);!(c=l()).done;){var a=c.value;a.name.includes("chrome")&&n({downloadUrl:a.browser_download_url,filename:a.name,tag:s.tag_name})}}r("Version "+t+" not found!")})}).on("error",function(e){throw console.warn("getGithubRelease error:",e.message),e})})},j=function(e){this.version=void 0,this.page=void 0,this.page=e};j.id=void 0,j.recommendedVersion=void 0,j.releasesUrl=void 0,j.homePath=void 0,j.download=void 0;var B=function(e){try{return Promise.resolve(e.waitForTimeout(3e3)).then(function(){})}catch(e){return Promise.reject(e)}},I=function(e,t,n){try{return Promise.resolve(A(e,t,n)).then(function(e){return Promise.resolve(e.click()).then(function(){})})}catch(e){return Promise.reject(e)}},F=function(e,t){try{return Promise.resolve(A(e,t,"button")).then(function(e){return Promise.resolve(e.click()).then(function(){})})}catch(e){return Promise.reject(e)}},x=function(e,t,n,r,o,i){void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=!1);try{var u,s,c=function(t){if(u)return t;function o(){return Promise.resolve(s.type(n)).then(function(){return!0})}var i=function(){if(r)return Promise.resolve(e.evaluate(function(e){e.value=""},s)).then(function(){})}();return i&&i.then?i.then(o):o()},l=function(n,r){try{var i=Promise.resolve(N(e,t,o,5e3)).then(function(e){s=e})}catch(e){return r(e)}return i&&i.then?i.then(void 0,r):i}(0,function(e){if(i)return u=1,!1;throw e});return Promise.resolve(l&&l.then?l.then(c):c(l))}catch(e){return Promise.reject(e)}},A=function(e,t,n){return void 0===n&&(n="*"),e.waitForSelector("//"+n+"[contains(text(), '"+t+"')]")},N=function(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=2e3),e.waitForSelector(["//label[contains(.,'"+t+"')]/following-sibling::textarea","//label[contains(.,'"+t+"')]/following-sibling::*//input","//h6[contains(.,'"+t+"')]/parent::node()/parent::node()/following-sibling::input","//h6[contains(.,'"+t+"')]/parent::node()/parent::node()/following-sibling::*//input"].concat(n?[]:["//span[contains(.,'"+t+"')]/parent::node()/parent::node()/following-sibling::*//input","//span[contains(.,'"+t+"')]/following-sibling::*//input"]).join("|"),{timeout:r})},C=function(e,t){try{return Promise.resolve(O(e,t)).then(function(e){return Promise.resolve(e.click()).then(function(){})})}catch(e){return Promise.reject(e)}},_=function(e){try{return Promise.resolve(e.waitForSelector(".network-display")).then(function(t){return Promise.resolve(t.click()).then(function(){return Promise.resolve(e.waitForSelector("li.dropdown-menu-item")).then(function(){})})})}catch(e){return Promise.reject(e)}},E=function(e){try{return Promise.resolve(e.waitForSelector(".account-menu__icon")).then(function(e){return Promise.resolve(e.click({noWaitAfter:!0,force:!0})).then(function(){})})}catch(e){return Promise.reject(e)}},U=function(e){try{return Promise.resolve(e.waitForSelector(".app-header__logo-container")).then(function(e){return Promise.resolve(e.click()).then(function(){})})}catch(e){return Promise.reject(e)}},O=function(e,t){return e.waitForSelector(["//span[contains(.,'"+t+"')]/parent::div/following-sibling::div/div/div/div","//span[contains(.,'"+t+"')]/parent::div/following-sibling::div/div/label/div"].join("|"))},V=function(e){try{var t={timeout:1e3};return Promise.resolve(Promise.race([e.waitForSelector("span.error",t),e.waitForSelector(".typography--color-error-1",t),e.waitForSelector(".typography--color-error-default",t),e.waitForSelector(".form-field__input--error",t)]).catch(function(){return null})).then(function(e){return!!e&&e.innerText})}catch(e){return Promise.reject(e)}},L=function(e){return function(t){var n=t.networkName,r=t.rpc,o=t.chainId,i=t.symbol;try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(_(e)).then(function(){return Promise.resolve(F(e,"Add network")).then(function(){return Promise.resolve(e.getByTestId("network-display").click()).then(function(){return Promise.resolve(e.getByRole("button",{name:"Add network"}).click()).then(function(){return Promise.resolve(e.getByTestId("add-network-manually").click()).then(function(){return Promise.resolve(e.getByLabel("Network name").fill(n)).then(function(){return Promise.resolve(e.getByLabel("New RPC URL").fill(r)).then(function(){return Promise.resolve(e.getByLabel("Chain ID").fill(String(o))).then(function(){return Promise.resolve(e.getByLabel("Currency symbol").fill(i)).then(function(){return Promise.resolve(V(e)).then(function(t){function r(t){return Promise.resolve(F(e,"Save")).then(function(){return Promise.resolve(e.waitForSelector("//*[text() = '"+n+"']")).then(function(){return Promise.resolve(e.isVisible("//button[contains(text(), 'Got it')]")).then(function(t){var n=function(){if(t)return Promise.resolve(F(e,"Got it")).then(function(){})}();if(n&&n.then)return n.then(function(){})})})})}var o=function(){if(t)return Promise.resolve(U(e)).then(function(){throw new SyntaxError(t)})}();return o&&o.then?o.then(r):r()})})})})})})})})})})})}catch(e){return Promise.reject(e)}}},R=function(e){return function(t){var n=t.tokenAddress,r=t.symbol,o=t.decimals,i=void 0===o?0:o;try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(I(e,"Import tokens")).then(function(){return Promise.resolve(e.waitForTimeout(500)).then(function(){return Promise.resolve(F(e,"Custom token")).then(function(){return Promise.resolve(x(e,"Token contract address",n)).then(function(){function t(){return Promise.resolve(N(e,"Token decimal")).then(function(t){return Promise.resolve(t.isDisabled()).then(function(n){function r(){return Promise.resolve(F(e,"Add custom token")).then(function(){return Promise.resolve(F(e,"Import tokens")).then(function(){})})}var o=function(){if(!n)return Promise.resolve(t.type(String(i))).then(function(){})}();return o&&o.then?o.then(r):r()})})}var n=function(){if(r)return Promise.resolve(x(e,"Token symbol",r,!0)).then(function(){})}();return n&&n.then?n.then(t):t()})})})})})}catch(e){return Promise.reject(e)}}},z=function(e,t){try{return Promise.resolve(e.context().waitForEvent("page")).then(function(e){return Promise.resolve(t(e)).then(function(){var t=function(){if(!e.isClosed())return Promise.resolve(e.waitForEvent("close")).then(function(){})}();if(t&&t.then)return t.then(function(){})})})}catch(e){return Promise.reject(e)}},G=function(e){return function(){try{return Promise.resolve(z(e,function(t){try{return Promise.resolve(t.waitForLoadState()).then(function(){return Promise.resolve(t.bringToFront()).then(function(){return Promise.resolve(t.locator('input[type="checkbox"]').first().check()).then(function(){return Promise.resolve(F(t,"Next")).then(function(){return Promise.resolve(F(t,"Connect")).then(function(){return Promise.resolve(B(e)).then(function(){return Promise.resolve(t.close()).then(function(){})})})})})})})}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},J=function(e){return function(t){try{return Promise.resolve(z(e,function(e){try{var n=function(){return Promise.resolve(e.getByTestId("page-container-footer-next").click()).then(function(){})},r=function(){if(t)return Promise.resolve(e.getByTestId("edit-gas-fee-button").click()).then(function(){return Promise.resolve(e.getByTestId("edit-gas-fee-item-custom").click()).then(function(){function n(){function n(){function n(){return Promise.resolve(e.getByRole("button",{name:"Save"}).click()).then(function(){})}var r=function(){if(t.gasLimit)return Promise.resolve(e.getByTestId("advanced-gas-fee-edit").click()).then(function(){return Promise.resolve(e.getByTestId("gas-limit-input").fill(String(t.gasLimit))).then(function(){})})}();return r&&r.then?r.then(n):n()}var r=function(){if(t.priority)return Promise.resolve(e.getByTestId("priority-fee-input").fill(String(t.priority))).then(function(){})}();return r&&r.then?r.then(n):n()}var r=function(){if(t.gas)return Promise.resolve(e.getByTestId("base-fee-input").fill(String(t.gas))).then(function(){})}();return r&&r.then?r.then(n):n()})})}();return Promise.resolve(r&&r.then?r.then(n):n())}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},K=function(e){return function(){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(E(e)).then(function(){return Promise.resolve(I(e,"Create account")).then(function(){return Promise.resolve(F(e,"Create")).then(function(){return Promise.resolve(B(e)).then(function(){})})})})})}catch(e){return Promise.reject(e)}}},q=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.waitForTimeout(500)).then(function(){return Promise.resolve(E(e)).then(function(){return Promise.resolve(I(e,"Account "+t)).then(function(){})})})})}catch(e){return Promise.reject(e)}}},Q=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){if(1===t)throw new SyntaxError("Account 1 cannot be deleted");return Promise.resolve(q(e)(t)).then(function(){return Promise.resolve(function(e){try{return Promise.resolve(function(e){return e.waitForSelector("button.menu-bar__account-options")}(e)).then(function(t){return Promise.resolve(t.click()).then(function(){return Promise.resolve(e.waitForSelector(".menu__container.account-options-menu")).then(function(){})})})}catch(e){return Promise.reject(e)}}(e)).then(function(){return Promise.resolve(I(e,"Remove account")).then(function(){return Promise.resolve(F(e,"Remove")).then(function(){return Promise.resolve(B(e)).then(function(){})})})})})})}catch(e){return Promise.reject(e)}}},W=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(_(e)).then(function(){return Promise.resolve(A(e,t)).then(function(n){return Promise.resolve(n.hover()).then(function(){return Promise.resolve(e.waitForSelector("//*[contains(text(), '"+t+"')]/following-sibling::i")).then(function(t){return Promise.resolve(t.click()).then(function(){return Promise.resolve(F(e,"Delete")).then(function(){return Promise.resolve(U(e)).then(function(){})})})})})})})})}catch(e){return Promise.reject(e)}}};function D(e,t,n){if(!e.s){if(n instanceof Z){if(!n.s)return void(n.o=D.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(D.bind(null,e,t),D.bind(null,e,2));e.s=t,e.v=n;const r=e.o;r&&r(e)}}var Z=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{D(r,1,i(this.v))}catch(e){D(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?D(r,1,t?t(o):o):n?D(r,1,n(o)):D(r,2,o)}catch(e){D(r,2,e)}},r},e}(),X=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.waitForTimeout(1e3)).then(function(){return Promise.resolve(e.$$(".asset-list-item__token-button")).then(function(n){var r,o,i,u,s,c,l,a=(o=n,i=function(o){return Promise.resolve(e.evaluate(function(e){return e.getAttribute("title")},n[o])).then(function(e){if(e.split(" ")[1].toUpperCase()===t.toUpperCase()){var n=e.split(" ")[0],o=parseFloat(n);return r=1,o}})},u=function(){return r},l=-1,function e(t){try{for(;++l<o.length&&(!u||!u());)if((t=i(l))&&t.then){if(!((n=t)instanceof Z&&1&n.s))return void t.then(e,c||(c=D.bind(null,s=new Z,2)));t=t.v}s?D(s,1,t):s=t}catch(e){D(s||(s=new Z),2,e)}var n}(),s);return a&&a.then?a.then(function(e){return r?e:0}):r?a:0})})})}catch(e){return Promise.reject(e)}}},$=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(E(e)).then(function(){return Promise.resolve(I(e,"Import account")).then(function(){return Promise.resolve(x(e,"your private key",t)).then(function(){return Promise.resolve(F(e,"Import")).then(function(){return Promise.resolve(V(e)).then(function(e){if(e)throw new SyntaxError(e)})})})})})})}catch(e){return Promise.reject(e)}}},H=function(e){return function(){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(E(e)).then(function(){return Promise.resolve(F(e,"Lock")).then(function(){})})})}catch(e){return Promise.reject(e)}}},M=function(e){return function(){try{return Promise.resolve(z(e,function(e){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.reload()).then(function(){return Promise.resolve(e.waitForSelector("div")).then(function(){return Promise.resolve(e.locator(".signature-request-message__scroll-button")).then(function(t){return Promise.resolve(t.count()).then(function(n){return Promise.resolve(t.count()).then(function(t){function n(){return Promise.resolve(F(e,"Sign")).then(function(){})}var r=function(){if(t>=1)return Promise.resolve(e.click(".signature-request-message__scroll-button")).then(function(){})}();return r&&r.then?r.then(n):n()})})})})})})}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},Y=function(e){return function(t){void 0===t&&(t="main");try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(_(e)).then(function(){return Promise.resolve(e.waitForSelector(":nth-match(li.dropdown-menu-item, 2)")).then(function(){return Promise.resolve(e.evaluate(function(e){for(var t=document.querySelectorAll("li.dropdown-menu-item"),n=0;n<t.length;n++)if(t[n].innerText.toLowerCase().includes(e.toLowerCase()))return n;return 0},t)).then(function(t){return Promise.resolve(e.evaluate(function(e){return document.querySelectorAll("li.dropdown-menu-item > span")[e].innerText},t)).then(function(n){return Promise.resolve(e.$$("li.dropdown-menu-item")).then(function(r){return Promise.resolve(r[t].click()).then(function(){return Promise.resolve(e.waitForSelector("//*[text() = '"+n+"']")).then(function(){})})})})})})})})}catch(e){return Promise.reject(e)}}};const ee="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function te(e,t,n){if(!e.s){if(n instanceof ne){if(!n.s)return void(n.o=te.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(te.bind(null,e,t),te.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var ne=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{te(r,1,i(this.v))}catch(e){te(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?te(r,1,t?t(o):o):n?te(r,1,n(o)):te(r,2,o)}catch(e){te(r,2,e)}},r},e}();function re(e){return e instanceof ne&&1&e.s}var oe=function(e){try{return Promise.resolve(e.getByTestId("onboarding-complete-done").click()).then(function(){return Promise.resolve(e.getByTestId("pin-extension-next").click()).then(function(){return Promise.resolve(e.getByTestId("pin-extension-done").click()).then(function(){})})})}catch(e){return Promise.reject(e)}},ie=function(e,t){var n=t.password,r=void 0===n?"password1234":n;try{return Promise.resolve(e.getByTestId("create-password-new").fill(r)).then(function(){return Promise.resolve(e.getByTestId("create-password-confirm").fill(r)).then(function(){return Promise.resolve(e.getByTestId("create-password-terms").click()).then(function(){return Promise.resolve(e.getByTestId("create-password-import").click()).then(function(){})})})})}catch(e){return Promise.reject(e)}},ue=function(e,t){var n=t.seed,r=void 0===n?"already turtle birth enroll since owner keep patch skirt drift any dinner":n;try{return Promise.resolve(e.getByTestId("onboarding-import-wallet").click()).then(function(){return Promise.resolve(e.getByTestId("metametrics-i-agree").click()).then(function(){function t(){return Promise.resolve(e.getByTestId("import-srp-confirm").click()).then(function(){})}var n=function(e,t,n){if("function"==typeof e[ee]){var r,o,i,u=e[ee]();if(function e(n){try{for(;!(r=u.next()).done;)if((n=t(r.value))&&n.then){if(!re(n))return void n.then(e,i||(i=te.bind(null,o=new ne,2)));n=n.v}o?te(o,1,n):o=n}catch(e){te(o||(o=new ne),2,e)}}(),u.return){var s=function(e){try{r.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(s,function(e){throw s(e)});s()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],l=0;l<e.length;l++)c.push(e[l]);return function(e,t,n){var r,o,i=-1;return function n(u){try{for(;++i<e.length;)if((u=t(i))&&u.then){if(!re(u))return void u.then(n,o||(o=te.bind(null,r=new ne,2)));u=u.v}r?te(r,1,u):r=u}catch(e){te(r||(r=new ne),2,e)}}(),r}(c,function(e){return t(c[e])})}(r.split(" ").entries(),function(t){return Promise.resolve(x(e,t[0]+1+".",t[1])).then(function(){})});return n&&n.then?n.then(t):t()})})}catch(e){return Promise.reject(e)}},se=function(e){try{return Promise.resolve(_(e)).then(function(){return Promise.resolve(I(e,"Show/hide")).then(function(){return Promise.resolve(C(e,"Advanced gas controls")).then(function(){return Promise.resolve(C(e,"Show test networks")).then(function(){return Promise.resolve(U(e)).then(function(){return Promise.resolve(B(e)).then(function(){})})})})})})}catch(e){return Promise.reject(e)}},ce=function(e){try{return Promise.resolve(new Promise(function(e){return setTimeout(e,1e3)})).then(function(){return Promise.resolve(e.locator(".popover-header__button").isVisible()).then(function(t){var n=function(){if(t)return Promise.resolve(e.$eval(".popover-header__button",function(e){return e.click()})).then(function(){})}();if(n&&n.then)return n.then(function(){})})})}catch(e){return Promise.reject(e)}},le=function(e){return function(t){void 0===t&&(t="password1234");try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.getByTestId("unlock-password").fill(t)).then(function(){return Promise.resolve(e.getByTestId("unlock-submit").click()).then(function(){return Promise.resolve(ce(e)).then(function(){})})})})}catch(e){return Promise.reject(e)}}};function ae(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}var fe="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function he(e,t,n){if(!e.s){if(n instanceof me){if(!n.s)return void(n.o=he.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(he.bind(null,e,t),he.bind(null,e,2));e.s=t,e.v=n;var r=e.o;r&&r(e)}}var me=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(t,n){var r=new e,o=this.s;if(o){var i=1&o?t:n;if(i){try{he(r,1,i(this.v))}catch(e){he(r,2,e)}return r}return this}return this.o=function(e){try{var o=e.v;1&e.s?he(r,1,t?t(o):o):n?he(r,1,n(o)):he(r,2,o)}catch(e){he(r,2,e)}},r},e}();function ve(e){return e instanceof me&&1&e.s}var de=function(e,t){var n=t.seed,r=void 0===n?"already turtle birth enroll since owner keep patch skirt drift any dinner":n,o=t.password,i=void 0===o?"password1234!!!!":o;try{return Promise.resolve(e.getByTestId("btn-import-existing-wallet").click()).then(function(){return Promise.resolve(e.getByTestId("btn-import-recovery-phrase").click()).then(function(){return Promise.resolve(e.getByTestId("seed-phrase-input").fill(r)).then(function(){return Promise.resolve(e.getByTestId("btn-import-wallet").click()).then(function(){return Promise.resolve(e.getByTestId("setPassword").fill(i)).then(function(){return Promise.resolve(e.getByTestId("setPasswordVerify").fill(i)).then(function(){return Promise.resolve(e.getByTestId("terms-and-privacy-policy").check()).then(function(){return Promise.resolve(e.getByTestId("btn-password-continue").click()).then(function(){return Promise.resolve(B(e)).then(function(){})})})})})})})})})}catch(e){return Promise.reject(e)}},Pe=function(e){try{return Promise.resolve(e.getByTestId("portfolio-navigation-link").click()).then(function(){})}catch(e){return Promise.reject(e)}},pe=function(e){try{return Promise.resolve(e.goto(e.url().split("?")[0])).then(function(){})}catch(e){return Promise.reject(e)}},ye=function(e){return function(){try{return Promise.resolve(z(e,function(e){try{return Promise.resolve(e.getByTestId("allow-authorize-button").click()).then(function(){})}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},ge=function(e){return function(){try{return Promise.resolve(z(e,function(e){try{return Promise.resolve(e.getByTestId("sign-message").click()).then(function(){})}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},we=function(e){return function(){try{return Promise.resolve(e.getByTestId("settings-navigation-link").click()).then(function(){return Promise.resolve(e.getByTestId("lock-wallet-button").click()).then(function(){})})}catch(e){return Promise.reject(e)}}},be=function(e){return function(t){void 0===t&&(t="password1234!!!!");try{return Promise.resolve(e.getByTestId("unlock-with-password").fill(t)).then(function(){return Promise.resolve(e.getByTestId("unlock-wallet-button").click()).then(function(){return Promise.resolve(Pe(e)).then(function(){return Promise.resolve(e.waitForSelector("//div[@data-testid='asset-list']//*[not(text='')]",{timeout:1e4})).then(function(){})})})})}catch(e){return Promise.reject(e)}}},ke=function(e){return function(){try{return Promise.resolve(z(e,function(e){try{var t=function(){return Promise.resolve(e.getByTestId("request-confirm-button").click()).then(function(){})},n=ae(function(){return Promise.resolve(e.waitForSelector("text='Got it'",{timeout:1e3})).then(function(e){return Promise.resolve(e.click()).then(function(){})})},function(){});return Promise.resolve(n&&n.then?n.then(t):t())}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},Te=function(e){return function(t){try{return Promise.resolve(e.context().newPage()).then(function(n){return Promise.resolve(n.goto(e.url()+"?internalPopUpRequest=true&action=addCustomNetwork")).then(function(){return Promise.resolve(n.getByTestId("custom-network-name-input").fill(t.networkName)).then(function(){return Promise.resolve(n.getByTestId("custom-network-rpc-url-input").fill(t.rpc)).then(function(){return Promise.resolve(n.getByTestId("custom-network-chain-id-input").fill(t.chainId.toString())).then(function(){return Promise.resolve(n.getByTestId("custom-network-currency-symbol-input").fill(t.symbol)).then(function(){return Promise.resolve(n.getByTestId("custom-network-save").click()).then(function(){function t(){function t(t){return Promise.resolve(n.waitForEvent("close")).then(function(){return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.reload()).then(function(){})})})}var o=function(){if(r)return Promise.resolve(r.textContent()).then(function(e){return Promise.resolve(n.close()).then(function(){throw new SyntaxError(e)})})}();return o&&o.then?o.then(t):t()}var r,o=ae(function(){return Promise.resolve(n.waitForSelector('//span[@data-testid="text-input-error-label"]',{timeout:50})).then(function(e){r=e})},function(){});return o&&o.then?o.then(t):t()})})})})})})})}catch(e){return Promise.reject(e)}}},Se=function(e){return function(t){try{return Promise.resolve(e.getByTestId("settings-navigation-link").click()).then(function(){return Promise.resolve(e.getByTestId("settings-networks-menu-cell-pressable").click()).then(function(){return Promise.resolve(e.getByTestId("network-list-search").fill(t)).then(function(){return Promise.resolve(e.waitForSelector('//div[@data-testid="list-"][1]//button')).then(function(t){return Promise.resolve(t.click()).then(function(){return Promise.resolve(e.getByTestId("custom-network-delete").click()).then(function(){return Promise.resolve(Pe(e)).then(function(){})})})})})})})}catch(e){return Promise.reject(e)}}},je=function(e){return function(t){try{return Promise.resolve(e.getByTestId("settings-navigation-link").click()).then(function(){return Promise.resolve(e.getByTestId("settings-networks-menu-cell-pressable").click()).then(function(){return Promise.resolve(e.getByTestId("network-list-search").fill(t)).then(function(){return Promise.resolve(e.isVisible('//div[@data-testid="list-"][1]//button')).then(function(t){return Promise.resolve(Pe(e)).then(function(){return t})})})})})}catch(e){return Promise.reject(e)}}},Be=function(e){return function(t){try{var n,r=function(){return n?Promise.resolve(n.textContent()).then(function(e){var n=e.replaceAll(/ |,/g,"").split(t)[2];return n?Number(n):0}):0},o=function(e,t,n){if("function"==typeof e[fe]){var r,o,i,u=e[fe]();if(function e(n){try{for(;!(r=u.next()).done;)if((n=t(r.value))&&n.then){if(!ve(n))return void n.then(e,i||(i=he.bind(null,o=new me,2)));n=n.v}o?he(o,1,n):o=n}catch(e){he(o||(o=new me),2,e)}}(),u.return){var s=function(e){try{r.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(s,function(e){throw s(e)});s()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],l=0;l<e.length;l++)c.push(e[l]);return function(e,t,n){var r,o,i=-1;return function n(u){try{for(;++i<e.length;)if((u=t(i))&&u.then){if(!ve(u))return void u.then(n,o||(o=he.bind(null,r=new me,2)));u=u.v}r?he(r,1,u):r=u}catch(e){he(r||(r=new me),2,e)}}(),r}(c,function(e){return t(c[e])})}([function(){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(e.getByTestId("portfolio-selector-nav-tabLabel--crypto").click()).then(function(){return Promise.resolve(e.waitForSelector('//button[contains(@data-testid, "asset-item")][contains(@data-testid, "'+t+'")]',{timeout:500}))})})}catch(e){return Promise.reject(e)}},function(){try{return Promise.resolve(e.getByTestId("portfolio-selector-nav-tabLabel--testnet").click()).then(function(){return Promise.resolve(e.waitForSelector('//button[contains(@data-testid, "asset-item")][contains(@data-testid, "'+t+'")]',{timeout:500}))})}catch(e){return Promise.reject(e)}}],function(e){var t=ae(function(){return Promise.resolve(e()).then(function(e){n=e})},function(){});if(t&&t.then)return t.then(function(){})});return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}}},Ie=function(e){return function(){try{return Promise.resolve(e.getByTestId("portfolio-header--switcher-cell-pressable").click()).then(function(){return Promise.resolve(e.getByTestId("wallet-switcher--manage").click()).then(function(){return Promise.resolve(e.getByTestId("manage-wallets-account-item--action-cell-pressable").click()).then(function(){function t(){return Promise.resolve(B(e)).then(function(){})}var n=ae(function(){return Promise.resolve(e.getByTestId("add-new-wallet--continue").click()).then(function(){})},function(){});return n&&n.then?n.then(t):t()})})})}catch(e){return Promise.reject(e)}}},Fe=function(e){return function(t){try{return Promise.resolve(e.getByTestId("portfolio-header--switcher-cell-pressable").click()).then(function(){return Promise.resolve(e.waitForSelector('(//button[@data-testid="wallet-switcher--wallet-item-cell-pressable"])['+t+"]")).then(function(e){return Promise.resolve(e.click()).then(function(){})})})}catch(e){return Promise.reject(e)}}},xe=function(e){try{return console.warn("deleteAccount not implemented - Coinbase does not support importing/removing additional private keys"),Promise.resolve()}catch(e){return Promise.reject(e)}},Ae=function(e){try{return console.warn("addToken not implemented - Coinbase does not support adding custom tokens"),Promise.resolve()}catch(e){return Promise.reject(e)}},Ne=function(e){try{return console.warn("importPK not implemented - Coinbase does not support importing/removing private keys"),Promise.resolve()}catch(e){return Promise.reject(e)}},Ce=function(e){try{return console.warn("switchNetwork not implemented"),Promise.resolve()}catch(e){return Promise.reject(e)}},_e=function(){try{return console.warn("confirmNetorkSwitch not implemented"),Promise.resolve()}catch(e){return Promise.reject(e)}},Ee=/*#__PURE__*/function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).options=void 0,t.defaultSetupSteps=[de,pe],t.setup=p(t.page,t.defaultSetupSteps),t.addNetwork=Te(t.page),t.addToken=Ae,t.approve=ye(t.page),t.createAccount=Ie(t.page),t.confirmNetworkSwitch=_e,t.confirmTransaction=ke(t.page),t.deleteAccount=xe,t.deleteNetwork=Se(t.page),t.getTokenBalance=Be(t.page),t.hasNetwork=je(t.page),t.importPK=Ne,t.lock=we(t.page),t.sign=ge(t.page),t.switchAccount=Fe(t.page),t.switchNetwork=Ce,t.unlock=be(t.page),t}return c(t,e),t}(j);Ee.id="coinbase",Ee.recommendedVersion="3.6.0",Ee.releasesUrl="https://api.github.com/repos/TenKeyLabs/coinbase-wallet-archive/releases",Ee.homePath="/index.html",Ee.download=w(Ee.id,Ee.releasesUrl,Ee.recommendedVersion);var Ue=function(e){return function(){try{return Promise.resolve(z(e,function(t){try{return Promise.resolve(F(t,"Switch network")).then(function(){return Promise.resolve(B(e)).then(function(){})})}catch(e){return Promise.reject(e)}})).then(function(){})}catch(e){return Promise.reject(e)}}},Oe=function(e){return function(t){try{return Promise.resolve(e.bringToFront()).then(function(){return Promise.resolve(_(e)).then(function(){return Promise.resolve(e.isVisible('//div[@class="network-dropdown-list"]/li[contains(string(), "'+t+'")]')).then(function(t){return Promise.resolve(e.waitForSelector(".network-display")).then(function(e){return e.click(),t})})})})}catch(e){return Promise.reject(e)}}},Ve=/*#__PURE__*/function(e){function t(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))||this).options=void 0,t.defaultSetupSteps=[ue,ie,oe,ce,se],t.setup=p(t.page,t.defaultSetupSteps),t.addNetwork=L(t.page),t.addToken=R(t.page),t.approve=G(t.page),t.createAccount=K(t.page),t.confirmNetworkSwitch=Ue(t.page),t.confirmTransaction=J(t.page),t.deleteAccount=Q(t.page),t.deleteNetwork=W(t.page),t.getTokenBalance=X(t.page),t.hasNetwork=Oe(t.page),t.importPK=$(t.page),t.lock=H(t.page),t.sign=M(t.page),t.switchAccount=q(t.page),t.switchNetwork=Y(t.page),t.unlock=le(t.page),t}return c(t,e),t}(j);Ve.id="metamask",Ve.recommendedVersion="10.25.0",Ve.releasesUrl="https://api.github.com/repos/metamask/metamask-extension/releases",Ve.homePath="/home.html",Ve.download=w(Ve.id,Ve.releasesUrl,Ve.recommendedVersion);var Le=[Ee,Ve],Re=function(e){var t=Le.find(function(t){return t.id===e});if(!t)throw new Error("Wallet "+e+" not supported");return t},ze=function(e,t){try{var n,r=function(e){if(n)return e;var r=t.pages()[1];return new o(r)},o=Re(e),i=function(){if(1===t.pages().length){var e,r=function(t){if(n)return t;var r=new o(e);return n=1,r},i=function(r,i){try{var u=Promise.resolve(t.waitForEvent("page",{timeout:2e3})).then(function(t){var r=new o(e=t);return n=1,r})}catch(e){return i()}return u&&u.then?u.then(void 0,i):u}(0,function(){return Promise.resolve(t.newPage()).then(function(t){return e=t,Promise.resolve(e.goto("chrome-extension://gadekpdjmpjjnnemgnhkbjgnjpdaakgh"+o.homePath)).then(function(){})})});return i&&i.then?i.then(r):r(i)}}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(e){return Promise.reject(e)}},Ge=["headless"],Je=function(e,t){try{var r=t.headless,o=a(t,Ge),u=Re(o.wallet);if(!u)throw new Error("Wallet not supported");return Promise.resolve(u.download(o)).then(function(e){return Promise.resolve(i.chromium.launchPersistentContext(n.join(Ke,o.wallet),{headless:null!=r&&r,args:["--disable-extensions-except="+e,"--load-extension="+e,"--start-maximized"]})).then(function(e){return Promise.resolve(ze(u.id,e)).then(function(t){return{wallet:t,browserContext:e}})})})}catch(e){return Promise.reject(e)}},Ke=n.resolve(o.tmpdir(),"dappwright","session"),qe=["seed","password","showTestNets"],Qe=function(e,r){var o=r.seed,i=r.password,u=r.showTestNets,s=a(r,qe);try{return t.existsSync(n.join(Ke,s.wallet))&&t.rmdirSync(n.join(Ke,s.wallet),{recursive:!0}),Promise.resolve(Je(0,s)).then(function(e){var t=e.browserContext;return function(e,n){try{var r=Promise.resolve(ze(s.wallet,t)).then(function(e){return Promise.resolve(e.setup({seed:o,password:i,showTestNets:u})).then(function(){return[e,e.page,t]})})}catch(e){return n(e)}return r&&r.then?r.then(void 0,n):r}(0,function(e){return Promise.resolve(t.close()).then(function(){throw e})})})}catch(e){return Promise.reject(e)}};export{Ee as CoinbaseWallet,Ve as MetaMaskWallet,Qe as bootstrap,ze as getWallet,Je as launch,Ke as sessionPath,p as setup};
//# sourceMappingURL=index.mjs.map
